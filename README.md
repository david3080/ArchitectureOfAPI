# APIアーキテクチャ　〜APIプラットフォームを設計運用進化させる〜

## はじめに
はじめに、APIの基礎とアーキテクチャへの旅の一部となるその可能性を見つけます。APIの簡単な定義とインプロセスAPIとアウトオブプロセスAPIについて説明します。APIの重要性を示すために、本書を通じて成長していく事例として会議システムを紹介します。アウトオブプロセスAPIは、単純な3層のアーキテクチャを超えた考え方を可能にします。これを示すために、トラフィックパターンとその重要性を紹介します。ケーススタディのステップの概要を説明しますので、興味のあるエリアがあればすぐに読み進めることができます。

APIとそれに関連するエコシステムを提示するために、一連の重要な成果物を使用します。[C4 モデル図](https://www.infoq.com/jp/articles/C4-architecture-model/)を使って事例を紹介し、アプローチの背後にある仕様と論理を再検討します。また、アーキテクチャ決定記録（ADR）の使用と、ソフトウェアライフサイクル全体にわたる決定を明確に定義することの価値について学びます。最後に、ADRガイドライン、すなわち「場合による」という答えがあるときに意思決定を行うのに役立つ我々のアプローチの概要を説明します。

### アーキテクチャへの旅
長旅をしたことのある人なら誰でも、時には何度でも「まだ着かないの?」と思ったことがあるでしょう。最初の数回は、GPSや経路探索を見て、道中で遅延が発生しないことを祈りながら、どのくらいで到着するかを調べます。同じくAPIベースのアーキテクチャを構築するための旅は開発者やアーキテクトにとって複雑なものになり得ます。アーキテクチャ用のGPSがあったとしてもあなたは目的地はどこだろうと悩むでしょう。

アーキテクチャは目的地のない旅であり、技術やアーキテクチャのアプローチがどのように変化していくかを予測することはできません。例えば、サービスメッシュ技術がこれほど広く使われるようになるとは予想できなかったかもしれませんが、その機能を知れば既存のアーキテクチャを進化させることを考えるきっかけになるかもしれません。アーキテクチャの変化に影響を与えるのは技術だけではありません。新しいビジネス要件や制約もアーキテクチャの方向性を変える原動力となります。

このように積み上げ式に価値を提供することと新たに登場した技術を組み合わせることで、進化型アーキテクチャのコンセプトが生まれます。進化型アーキテクチャとは、アーキテクチャを積み上げ式で進化させるアプローチであり、スピード感をもって変化させ悪影響を及ぼすリスクを低減させることに重点を置きます。その過程で、APIアーキテクチャにアプローチする際の以下のアドバイスを心に留めておいてください。

>アーキテクトは戦略的な将来計画を立てたいものですが、ソフトウェア開発のエコシステムが常に変化しているため、それは困難なことです。変化を避けることはできないので、変化を利用する必要があるのです。
>[進化的アーキテクチャ](https://www.oreilly.co.jp/books/9784873118567/)より

多くのプロジェクトにおいて、APIそのものは進化的であり、より多くのシステムやサービスが統合されるにつれて変化を求められます。ほとんどの開発者は、利用者の視点からより広範なAPIの再利用を考慮することなく、単一の機能に焦点を当てたサービスを構築してきました。

APIファースト設計は、開発者やアーキテクトがサービスの機能を考慮し、利用者中心にAPIをデザインするアプローチをとります。API利用者はモバイルアプリや他のサービス、あるいは外部の顧客である可能性もあります。第1章では、APIファーストのアプローチをサポートする設計テクニックをレビューし、変化に強く幅広い利用者層に価値を提供するAPIを構築する方法を見つけます。

よい話としては、API駆動型アーキテクチャの旅はどの時点からでも始められるということです。もしあなたが既存の技術の棚卸しを担当しているなら、私たちはあなたのプラットフォームでAPIの利用を促進するためにアーキテクチャを進化させるテクニックをお見せします。一方、もしあなたが幸運にも何もないキャンバスをお持ちなら、私たちの長年の経験に基づいてAPIアーキテクチャを採用する利点を共有し、意思決定における重要な要因も強調して紹介します。 

## APIの簡単な紹介
ソフトウェアアーキテクチャの分野では、定義するのが非常に難しい用語がいくつかある。アプリケーションプログラミングインターフェイスの略であるAPIという用語もこの種類のもので、その概念は80年も前にあらわれたものです。長い間使われてきた用語は、結局使い古され、異なる問題領域で複数の意味を持つようになります。我々はAPIを以下のように考えています。

- APIは基礎となる実装を抽象化したものである。
- APIは型を導入した仕様で表現される。開発者は仕様を理解しツールを使って複数の言語でコードを生成しAPI利用者（APIを消費するソフトウェア）を実装することができる。
- APIは情報交換を効果的にモデル化するためにセマンティクスや動作を定義している。
- 効果的なAPI設計により、顧客や第三者への拡張を可能にし、ビジネス統合を実現する。

大まかに言って、APIはAPIの呼び出しがプロセス内かプロセス外かによって、2つの一般的なカテゴリに分けることができます。ここでいうプロセスとは、オペレーティング・システム（OS）のプロセスのことです。たとえば、あるクラスから別のクラスへのJavaメソッドの呼び出しは、呼び出しが行われたのと同じプロセスで処理されるため、プロセス内APIの呼び出しとなります。HTTPライブラリを使用して外部のREST的なAPIを呼び出す.NETアプリケーションは、呼び出し元のプロセス以外の追加の外部プロセスによって処理されるため、プロセス外のAPI呼び出しとなります。典型的なアウトオブプロセスAPI呼び出しは、ローカルネットワーク、仮想プライベートクラウド（VPC）ネットワーク、またはインターネットなど、ネットワークのデータトラバーシングを伴う可能性があります。我々は後者のAPIスタイルに焦点を当てます。しかし、アーキテクトはしばしばインプロセスAPIをアウトオブプロセスAPIに改造する必要性に遭遇します。この概念（および他の概念）を示すために、本書を通じて発展するケーススタディを作成します。